#### HTTP特点

```
1.灵活可扩展，主要体现在两个方面。一个是语义上的自由，只规定了基本格式，比如空格分隔单词，换行分隔字段，其他的各个部分都没有严格的语法限制。另一个是传输形式的多样性，不仅仅可以传输文本，还能传输图片、视频等任意数据(Content-Type标记)，非常方便。

2.可靠传输。HTTP 基于 TCP/IP，因此把这一特性继承了下来。这属于 TCP 的特性，不具体介绍了。

3.请求-应答。也就是一发一收、有来有回， 当然这个请求方和应答方不单单指客户端和服务器之间，如果某台服务器作为代理来连接后端的服务端，那么这台服务器也会扮演请求方的角色。

4.无状态。这里的状态是指通信过程的上下文信息，而每次 http 请求都是独立、无关的，默认不需要保留状态信息。
```

#### HTTP缺点

```
所谓的优点和缺点还是要分场景来看的，对于 HTTP 而言，最具争议的地方在于它的无状态。
在需要长连接的场景中，需要保存大量的上下文信息，以免传输大量重复的信息，那么这时候无状态就是 http 的缺点了。
但与此同时，另外一些应用仅仅只是为了获取一些数据，不需要保存连接上下文信息，无状态反而减少了网络开销，成为了 http 的优点。

开启长连接时，只建立一个TCP连接，同时只能处理一个请求，可能会阻塞

通信使用明文，内容可能会被窃听
报文不使用二进制数据，而是文本形式，调试方便但是将报文信息暴露给了外界

不验证通信方的身份，可能会遭遇伪装
无法验证报文的完整性，可能被篡改
解决方法使用https
```

#### 长连接

```
http1.0协议采用的是"请求-应答"模式，当使用普通模式，每个请求/应答客户与服务器都要新建一个连接，完成之后立即断开连接(http协议为无连接的协议)
1.1版本支持长连接，在请求头添加字段Connection：Keep-Alive,使用Keep-Alive模式(又称持久连接，连接复用)建立一个TCP连接后使客户端到服务端的连接持续有效，可以发送/接受多个http请求/响应，当出现对服务器的后续请求时，Keep-Alive功能避免了建立或者重新建立连接。

优点：
减少CPU及内存的使用，因为不需要经常建立和关闭连接
支持管道化的请求及响应模式
减少网络堵塞，因为减少了TCP请求
减少了后续请求的响应时间，因为不需要等待建立TCP、握手、挥手、关闭TCP的过程
发生错误时，也可在不关闭连接的情况下进行错误提示



缺点：
一个长连接建立后，如果一直保持连接，对服务器来说是多么的浪费资源呀，而且长连接时间的长短，直接影响到服务器的并发数

还有就是可能造成队头堵塞，造成信息延迟

避免长连接资源浪费：
请求头添加字段Connection：close 本次请求后就关闭连接
服务器配置：Nginx 设置keepalive_timeout 长连接超时时间，keepalive_requests长连接请求次数上限

```

![image-20220401101103070](\image\image-20220401101103070.png)

##### 管线化

管线化：在同一个TCP连接里发一个请求后不必等其回来就可以继续发请求出去，这可以减少整体的响应时间，但是服务器还是会按照请求的顺序响应请求，所以如果有许多请求，而前面的请求响应很慢，就产生一个著名的问题队头堵塞
(请求1 -> 请求2 -> 请求3 -> 响应1 -> 响应2 -> 响应3) 类似于Promise

管线化的特点：

- 管线化机制通过持久连接完成，在`http1.1`版本才支持
- 只有`GET`请求和`HEAD`请求才可以进行管线化，而`POST`有所限制
- 初次创建连接时不应启动管线化机制，因为服务器不一定支持http1.1版本的协议
- 管线化不会影响响应到来的顺序，如上面的例子所示，响应返回的顺序就是请求的顺序
- 要求`客户端`和`服务端`都支持管线化，但并不要求服务端也对响应进行管线化处理，只是要求对于管线化的请求不失败即可
- 由于上面提到的服务端问题，开户管线化很可能并不会带来大幅度的性能提升，而且很多服务端和代理程序对管线化的支持并不好，因为浏览器(Chrome/Firefox)默认并未开启管线化支持

##### 解决队头阻塞的问题

```
因为http采用的是请求-应答模式，报文必须是一发一收，形成了一个先进先出的串行队列，如果某个请求耗时过长，就会阻塞后面的请求。

并发连接：
分配多个长连接，增加任务队列，一个域名可以有6-8个长连接，Chrome支持6个，fireFox8个

域名分片：
提供多个域名。
比如a.baidu.com，b.baidu.com，c.baidu.com，多准备几个二级域名，当我们访问baidu.com时，可以让不同的资源从不同的二域名中获取，而它们都指向同一台服务器，这样能够并发更多的长连接了
而在HTTP2.0下，可以一瞬间加载出来很多资源，因为支持多路复用，可以在一个TCP连接中发送多个请求

```

