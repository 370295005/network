##### HTTPS

HTTPS 是超文本传输安全协议，即HTTP + SSL/TLS

![image-20220401141029269](\image\image-20220401141029269.png)

###### SSL/TLS

![image-20220401141349707](\image\image-20220401141349707.png)

浏览器和服务器通信之前会先协商，选出它们都支持的`加密套件`，用来实现安全的通信

以**RSA-PSK-AES128-GCM-SHA256**为例

![image-20220401142947867](\image\image-20220401142947867.png)

**`RSA`**：表示握手时用RSA算法交换密钥

**`PSK`**：表示使用PSK算法签名

**`AES128-GCM`**：表示使用AES对称加密算法通信，密钥长度128，分组模式GCM。TLS 1.3中只剩下的对称加密算法有**AES**和**CHACHA20**，分组模式只剩下**GCM**和**POLY1305**

**`SHA256`**：表示使用SHA256算法验证信息完整性并生成随机数。TLS 1.3中哈希摘要算法只剩下**SHA256**和**SHA384**了

TLS需要保证信息的：`机密性`、`可用性`、`完整性`、`认证性`、`不可否认性`

###### 对称加密算法

```
就是加密和解密使用同一个密钥。如AES、DES。加解密过程：

浏览器给服务器发送一个随机数client-random和一个支持的加密方法列表
服务器给浏览器返回另一个随机数server-random和双方都支持的加密方法
然后两者用加密方法将两个随机数混合生成密钥，这就是通信双方加解密的密钥

问题是双方如何安全的传递两个随机数和加密方法，直接传给客户端，那过程中就很可能被窃取，别人就能成功解密拿到数据。
```

###### 不对称加密算法

```
就是一对密钥，有公钥(public key)和私钥(private key)，其中一个密钥加密后的数据，只能用另一个密钥进行解密。如RSA、ECDHE。加解密过程：

浏览器给服务器发送一个随机数client-random和一个支持的加密方法列表
服务器把另一个随机数server-random、加密方法、公钥传给浏览器
然后浏览器用公钥将两个随机数加密，生成密钥，这个密钥只能用私钥解密

使用公钥反推出私钥是非常困难，但不是做不到，随着计算机运算能力提高，非对称密钥至少要2048位才能保证安全性，这就导致性能上要比对称加密要差很多
```

TLS实际用的是`两种算法的混合加密`。**通过 非对称加密算法 交换 对称加密算法 的密钥，交换完成后，再使用对称加密进行加解密传输数据**。这样就保证了会话的机密性。过程如下

1. 浏览器给服务器发送一个随机数`client-random`和一个支持的加密方法列表
2. 服务器把另一个随机数`server-random`、`加密方法`、`公钥`传给浏览器
3. 浏览器又生成另一个随机数`pre-random`，并用公钥加密后传给服务器
4. 服务器再用私钥解密，得到`pre-random`
5. 浏览器和服务器都将三个随机数用加密方法混合生成最终密钥

这样即便被截持，中间人没有私钥就拿不到`pre-random`，就无法生成最终密钥。

###### 摘要算法

```
主要用于保证信息的完整性。常见的MD5算法、散列函数、哈希函数都属于这类算法，其特点就是单向性、无法反推原文

假如信息被截取，并重新生成了摘要，这时候就判断不出来是否被篡改了，所以需要给摘要也通过会话密钥进行加密，这样就看不到明文信息，保证了安全性，同时也保证了完整性
```

###### 数字证书(签名)

```
它可以帮我们验证服务器身份。因为如果没有验证的话，就可能被中间人劫持，假如请求被中间人截获，中间人把他自己的公钥给了客户端，客户端收到公钥就把信息发给中间人了，中间人解密拿到数据后，再请求实际服务器，拿到服务器公钥，再把信息发给服务器
这样不知不觉间信息就被人窃取了，所以在结合对称和非对称加密的基础上，又添加了数字证书认证的步骤，让服务器证明自己的身份
数字证书需要向有权威的认证机构(CA)获取授权给服务器。首先，服务器和CA机构分别有一对密钥(公钥和私钥)，然后是如何生成数字证书的呢？

CA机构通过摘要算法生成服务器公钥的摘要(哈希摘要)
CA机构通过CA私钥及特定的签名算法加密摘要，生成签名
把签名、服务器公钥等信息打包放入数字证书，并返回给服务器

服务器配置好证书，以后客户端连接服务器，都先把证书发给客户端验证并获取服务器的公钥。
```

**证书验证流程**

- 使用**CA公钥**和声明的签名算法对CA中的签名进行**解密**，得到服务器公钥的`摘要内容`
- 再用摘要算法对证书里的服务器公钥生成摘要，再把这个摘要和上一步得到的摘要`对比`，如果一致说明证书合法，里面的公钥也是正确的，否则就是非法的

证书认证又分为`单向认证`和`双向认证`

**单向认证**：服务器发送证书，客户端验证证书
 **双向认证**：服务器和客户端分别提供证书给对方，并互相验证对方的证书

**不过大多数https服务器都是单向认证，如果服务器需要验证客户端的身份，一般通过用户名、密码、手机验证码等之类的凭证来验证。只有更高级别的要求的系统，比如大额网银转账等，就会提供双向认证的场景，来确保对客户身份提供认证性**

##### HTTPS优缺点

```
优点
    内容加密，中间无法查看原始内容
    身份认证，保证用户访问正确。如访问百度，即使DNS被劫持到第三方站点，也会提醒用户没有访问百度服务，可能被劫持
    数据完整性，防止内容被第三方冒充或篡改
    虽然不是绝对安全，但是现行架构下最安全的解决文案了，大大增加了中间人的攻击成本

缺点
    要钱，功能越强大的证书费用越贵
    证书需要绑定IP，不能在同一个IP上绑定多个域名
    https双方加解密，耗费更多服务器资源
    https握手更耗时，降低一定用户访问速度(优化好就不是缺点了)

```

##### 区别

```
HTTP是明文传输，不安全的，HTTPS是加密传输，安全的多
HTTP标准端口是80，HTTPS标准端口是443
HTTP不用认证证书免费，HTTPS需要认证证书要钱
连接方式不同，HTTP三次握手，HTTPS中TLS1.2版本7次，TLS1.3版本6次
HTTP在OSI网络模型中是在应用层，而HTTPS的TLS是在传输层
HTTP是无状态的，HTTPS是有状态的
```

